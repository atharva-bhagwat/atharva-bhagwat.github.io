---
layout: post
title: Understanding 10x Xenium Data Analysis
categories: articles
permalink: articles/10x-xenium
author: Atharva Bhagwat
---

## Overview of Spatial Transcriptomics (ST)

Traditional single-cell RNA sequencing (scRNA-seq) dissociates cells and profiles gene expression at single cell resolution. It is able to capture the heterogeneity within tissues and gives high resolution insight into cellular functions.

While this type of data can be used to analyze variations in gene expression, it lacks the spatial information for cells, which adds a dimension of information. Enter ‘Spatial Transcriptomics’! Spatial transcriptomics has revolutionized our ability to understand biology by capturing the spatial information. Having spatial context allows us to look deeper into cell-cell interactions, cellular niches, and various microenvironments across conditions.

Over the last 6 years, spatial transcriptomics technologies have advanced at a rapid speed and each come with various advantages. Detailed table can be found [here](https://divingintogeneticsandgenomics.com/post/python-visium/).

## Overview of Xenium

Xenium is a single-cell resolution technology commercialized by 10x genomics in 2023. It uses RNA based transcripts and can target up to 5000 genes. It captures transcripts at subcellular level. Xenium v2 has nuclear and cell membrane staining which are used for cell segmentation, as compared to v1 which only had nuclear staining and detected cells based on cell-boundary expansion.

## Understand 10x output files

The Xenium analyzer has numerous outputs we only need some of them to start with data analysis. Here are those files:

| File Type | File and Description |
|------------------------|------------------------|
| **Cell summary** | `cells.parquet`: Cell summary file in Parquet format. |
| **Cell-feature matrix**| `cell_feature_matrix.h5`: Cell-feature matrix file in HDF5 format. |

**Table 2: Xenium Onboard Analysis Output Files ([ref](https://www.10xgenomics.com/support/software/xenium-onboard-analysis/2.0/tutorials/outputs/xoa-output-at-a-glance)).**

## Getting started with data analysis

I will use the [Xenium Human Pancreatic Dataset](https://www.10xgenomics.com/products/xenium-human-pancreatic-dataset-explorer) for showcase. *Please note that this data was generated using Xenium v1, ie: cells are detected using cell boundary expansion.*

```bash
# Output Files
wget https://cf.10xgenomics.com/samples/xenium/1.6.0/Xenium_V1_hPancreas_Cancer_Add_on_FFPE/Xenium_V1_hPancreas_Cancer_Add_on_FFPE_outs.zip
```

### Installing necessary libraries

```bash
pip install anndata scanpy squidpy
```

### Loading the data as an AnnData object from raw output files

```python

import os
import anndata as ad
import scanpy as sc

# load count matrix
adata = sc.read_10x_h5(os.path.join(DIR_PATH, 'cell_feature_matrix.h5'))

# load cells metadata
cells = pd.read_parquet(os.path.join(slide_path, 'cells.parquet'))
cells.index = cells['cell_id']
cells.drop(['cell_id'], inplace=True, axis=1)

# set spatial info
adata.obsm["spatial"] = adata.obs[["x_centroid", "y_centroid"]].copy().to_numpy()

adata.write_h5ad(os.path.join(OUT_DIR, 'xenium_adata.h5ad'))
```

### Understanding xenium data structure

```python

```
